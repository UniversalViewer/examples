(window.webpackJsonpUV=window.webpackJsonpUV||[]).push([[5],{110:function(t,e,n){"use strict";n.r(e);var i,o=function(){},s=n(3),a=n(71),r=n(50),h=n(4),l=n(36),p=n(52),c=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(e){var n=t.call(this,e,!0,!0)||this;return n.isOpen=!1,n}return c(e,t),e.prototype.create=function(){this.setConfig("contentLeftPanel"),t.prototype.create.call(this),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)},e.prototype.setup=function(){var t=this;this.galleryComponent=new p.a({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",(function(e){t.component.publish(s.a.GALLERY_THUMB_SELECTED,e),t.component.publish(s.a.THUMB_SELECTED,e)}),!1),this.galleryComponent.on("decreaseSize",(function(){t.component.publish(s.a.GALLERY_DECREASE_SIZE)}),!1),this.galleryComponent.on("increaseSize",(function(){t.component.publish(s.a.GALLERY_INCREASE_SIZE)}),!1)},e.prototype.databind=function(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()},e.prototype.show=function(){var t=this;this.isOpen=!0,this.$element.show(),setTimeout((function(){t.galleryComponent.selectIndex(t.extension.helper.canvasIndex)}),10)},e.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},e.prototype.resize=function(){t.prototype.resize.call(this);var e=this.$gallery.find(".main"),n=this.$gallery.find(".header");e.height(this.$element.height()-n.height())},e}(l.a),d=n(53),g=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.image=new t("image"),t.page=new t("page"),t}(),f=n(55),b=function(){function t(){}return t.namespace="openseadragonExtension.",t.CURRENT_VIEW_URI=t.namespace+"currentViewUri",t.IMAGE_SEARCH=t.namespace+"imageSearch",t.MODE_CHANGED=t.namespace+"modeChanged",t.NEXT_SEARCH_RESULT=t.namespace+"nextSearchResult",t.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=t.namespace+"nextImagesSearchResultUnavailable",t.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=t.namespace+"prevImagesSearchResultUnavailable",t.PAGE_SEARCH=t.namespace+"pageSearch",t.PAGING_TOGGLED=t.namespace+"pagingToggled",t.PREV_SEARCH_RESULT=t.namespace+"prevSearchResult",t.PRINT=t.namespace+"print",t.ROTATE=t.namespace+"rotate",t.OPENSEADRAGON_ANIMATION_FINISH=t.namespace+"animationFinish",t.OPENSEADRAGON_ANIMATION_START=t.namespace+"animationStart",t.OPENSEADRAGON_ANIMATION=t.namespace+"animation",t.OPENSEADRAGON_OPEN=t.namespace+"open",t.OPENSEADRAGON_RESIZE=t.namespace+"resize",t.OPENSEADRAGON_ROTATION=t.namespace+"rotationChanged",t.SEARCH_PREVIEW_FINISH=t.namespace+"searchPreviewFinish",t.SEARCH_PREVIEW_START=t.namespace+"searchPreviewStart",t.SEARCH=t.namespace+"search",t.XYWH_CHANGED=t.namespace+"xywhChanged",t.ZOOM_IN=t.namespace+"zoomIn",t.ZOOM_OUT=t.namespace+"zoomOut",t}(),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.create=function(){var e=this;this.setConfig("contentLeftPanel"),t.prototype.create.call(this),this.component.subscribe(b.MODE_CHANGED,(function(){e.setLabel()})),this.component.subscribe(b.SEARCH_PREVIEW_START,(function(t){e.searchPreviewStart(t)})),this.component.subscribe(b.SEARCH_PREVIEW_FINISH,(function(){e.searchPreviewFinish()})),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var n=this;$.views.helpers({separator:function(){return!n.extension.helper.isPaged()||(this.data.index-1)%2!=0}})},e.prototype.addSelectedClassToThumbs=function(t){for(var e=this.extension.getPagedIndices(t),n=0;n<e.length;n++)this.getThumbByIndex(e[n]).addClass("selected")},e.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===g.page.toString():this.config.options.pageModeEnabled},e.prototype.searchPreviewStart=function(t){this.scrollToThumb(t),this.getThumbByIndex(t).addClass("searchpreview")},e.prototype.searchPreviewFinish=function(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")},e.prototype.setLabel=function(){this.isPDF()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()):($(this.$thumbs).find("span.index").show(),$(this.$thumbs).find("span.label").hide())},e}(f.a),E=n(75),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),x=function(t){function e(e){var n=t.call(this,e,!0,!0)||this;return n.isOpen=!1,n}return T(e,t),e.prototype.create=function(){this.setConfig("contentLeftPanel"),t.prototype.create.call(this),this.$tree=$('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)},e.prototype.setup=function(){var t=this;this.treeComponent=new E.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",(function(e){t.component.publish(s.a.TREE_NODE_SELECTED,e)}),!1),this.treeComponent.on("treeNodeMultiSelected",(function(e){t.component.publish(s.a.TREE_NODE_MULTISELECTED,e)}),!1)},e.prototype.databind=function(){var t=this;setTimeout((function(){t.treeComponent.set(t.treeData),t.resize()}),1)},e.prototype.show=function(){this.isOpen=!0,this.$element.show()},e.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},e.prototype.selectNode=function(t){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(t,!0);var e=this.$tree.find("#tree-link-"+t.id)[0];e&&e.scrollIntoViewIfNeeded()}this.treeComponent.selectNode(t)},e.prototype.expandNode=function(t,e){this.treeComponent.expandNode(t,e)},e.prototype.getAllNodes=function(){return this.treeComponent.getAllNodes()},e.prototype.deselectCurrentNode=function(){this.treeComponent.deselectCurrentNode()},e.prototype.getNodeById=function(t){return this.treeComponent.getNodeById(t)},e.prototype.resize=function(){t.prototype.resize.call(this)},e}(l.a),_=n(1),w=n(8),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),A=n(51).ViewingDirection,y=n(51).ViewingHint,C=function(t){function e(e){var n=t.call(this,e)||this;return n.expandFullEnabled=!1,n.isThumbsViewOpen=!1,n.isTreeViewOpen=!1,n.treeSortType=w.c.NONE,n}return R(e,t),e.prototype.create=function(){var e=this;this.setConfig("contentLeftPanel"),t.prototype.create.call(this),this.component.subscribe(s.a.SETTINGS_CHANGED,(function(){e.databind()})),this.component.subscribe(s.a.GALLERY_THUMB_SELECTED,(function(){e.collapseFull()})),this.component.subscribe(s.a.METRIC_CHANGED,(function(){e.extension.isDesktopMetric()||e.isFullyExpanded&&e.collapseFull()})),this.component.subscribe(s.a.ANNOTATIONS,(function(){e.databindThumbsView(),e.databindGalleryView()})),this.component.subscribe(s.a.ANNOTATIONS_CLEARED,(function(){e.databindThumbsView(),e.databindGalleryView()})),this.component.subscribe(s.a.ANNOTATIONS_EMPTY,(function(){e.databindThumbsView(),e.databindGalleryView()})),this.component.subscribe(s.a.CANVAS_INDEX_CHANGED,(function(){e.isFullyExpanded&&e.collapseFull(),e.selectCurrentTreeNode(),e.updateTreeTabBySelection()})),this.component.subscribe(s.a.RANGE_CHANGED,(function(){e.isFullyExpanded&&e.collapseFull(),e.selectCurrentTreeNode(),e.updateTreeTabBySelection()})),this.$tabs=$('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=$('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=$('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$thumbsButton.prop("title",this.content.thumbnails),this.$tabs.append(this.$thumbsButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=$('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=$('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=$('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=$('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=$('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=$('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=$('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=$('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=$('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=$('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=$('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=$('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=$('<div class="thumbsView" tabindex="0"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=$('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change((function(){e.databindTreeView(),e.selectCurrentTreeNode(),e.updateTreeTabBySelection()})),this.$sortByDateButton.on("click",(function(){e.sortByDate()})),this.$sortByVolumeButton.on("click",(function(){e.sortByVolume()})),this.$treeViewOptions.hide(),this.$treeButton.onPressed((function(){e.openTreeView()})),this.$thumbsButton.onPressed((function(){e.openThumbsView()})),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var n=this.options.tabOrder;n&&("thumbs"===(n=(n=n.toLowerCase()).replace(/ /g,"")).split(",")[0]?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first"))},e.prototype.createTreeView=function(){this.treeView=new x(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();var t=this.extension.helper.getTopRanges();if(t.length>1)for(var e=0;e<t.length;e++){var n=t[e];this.$treeSelect.append('<option value="'+n.id+'">'+_.LanguageMap.getValue(n.getLabel())+"</option>")}this.updateTreeViewOptions()},e.prototype.databind=function(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()},e.prototype.updateTreeViewOptions=function(){var t=this.getTree();t&&(this.isCollection()&&this.extension.helper.treeHasNavDates(t)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())},e.prototype.sortByDate=function(){this.treeSortType=w.c.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()},e.prototype.sortByVolume=function(){this.treeSortType=w.c.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()},e.prototype.isCollection=function(){var t=this.getTree();if(t)return t.data.type===_.TreeNodeType.COLLECTION;throw new Error("Tree not available")},e.prototype.databindTreeView=function(){this.treeView&&(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())},e.prototype.getTreeData=function(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:h.b.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:h.b.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}},e.prototype._isTreeAutoExpanded=function(){var t=h.b.getBool(this.config.options.autoExpandTreeEnabled,!1),e=this.config.options.autoExpandTreeIfFewerThan||0;if(t){var n=this.extension.helper.getFlattenedTree();if(n&&n.length<e)return!0}return!1},e.prototype.updateTreeTabByCanvasIndex=function(){var t=this.extension.helper.getTopRanges();if(t.length>1){var e=this.getCurrentCanvasTopRangeIndex();if(-1===e)return;var n=t[e];this.setTreeTabTitle(_.LanguageMap.getValue(n.getLabel()))}else this.setTreeTabTitle(this.content.index)},e.prototype.setTreeTabTitle=function(t){this.$treeButton.text(t),this.$treeButton.prop("title",t)},e.prototype.updateTreeTabBySelection=function(){var t=null,e=this.extension.helper.getTopRanges();e.length>1&&(t=this.treeView?this.getSelectedTree().text():_.LanguageMap.getValue(e[0].getLabel())),t?this.setTreeTabTitle(t):this.setTreeTabTitle(this.content.index)},e.prototype.getViewingHint=function(){return this.extension.helper.getViewingHint()},e.prototype.getViewingDirection=function(){return this.extension.helper.getViewingDirection()},e.prototype.createThumbsView=function(){this.thumbsView=new v(this.$thumbsView),this.databindThumbsView()},e.prototype.databindThumbsView=function(){if(this.thumbsView){var t,e,n=this.getViewingHint(),i=this.getViewingDirection();!i||i!==A.LEFT_TO_RIGHT&&i!==A.RIGHT_TO_LEFT?n&&n===y.PAGED?(t=this.config.options.twoColThumbWidth,e=this.config.options.twoColThumbHeight):(t=this.config.options.oneColThumbWidth,e=this.config.options.oneColThumbHeight):(t=this.config.options.twoColThumbWidth,e=this.config.options.twoColThumbHeight);var o=this.extension.helper.getThumbs(t,e);i&&i===A.BOTTOM_TO_TOP&&o.reverse();var s=this.extension.annotations;if(s&&s.length)for(var a=function(t){var e=s[t],n=o.filter((function(t){return t.index===e.canvasIndex}))[0];if(n){var i=$.extend(!0,{},n.data);i.searchResults=e.rects.length,n.data=i}},r=0;r<s.length;r++)a(r);this.thumbsView.thumbs=o,this.thumbsView.databind()}},e.prototype.createGalleryView=function(){this.galleryView=new u(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()},e.prototype.databindGalleryView=function(){this.galleryView&&(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())},e.prototype.getGalleryData=function(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}},e.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?h.b.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===g.page.toString():h.b.getBool(this.config.options.pageModeEnabled,!0)},e.prototype.getSelectedTree=function(){return this.$treeSelect.find(":selected")},e.prototype.getSelectedTopRangeIndex=function(){var t=this.getSelectedTree().index();return-1===t&&(t=0),t},e.prototype.getTree=function(){var t=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(t,w.c.NONE)},e.prototype.toggleFinish=function(){if(t.prototype.toggleFinish.call(this),this.isUnopened){var e=h.b.getBool(this.config.options.treeEnabled,!0),n=h.b.getBool(this.config.options.thumbsEnabled,!0),i=this.getTree();i&&i.nodes.length||(e=!1),e&&n||this.$tabs.hide(),n&&this.defaultToThumbsView()?this.openThumbsView():e&&this.openTreeView()}},e.prototype.defaultToThumbsView=function(){var t=h.b.getBool(this.config.options.defaultToTreeEnabled,!1),e=this.config.options.defaultToTreeIfGreaterThan||0,n=this.getTree();return!(t&&n&&n.nodes.length>e)},e.prototype.expandFullStart=function(){t.prototype.expandFullStart.call(this),this.component.publish(s.a.LEFTPANEL_EXPAND_FULL_START)},e.prototype.expandFullFinish=function(){t.prototype.expandFullFinish.call(this),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(s.a.LEFTPANEL_EXPAND_FULL_FINISH)},e.prototype.collapseFullStart=function(){t.prototype.collapseFullStart.call(this),this.component.publish(s.a.LEFTPANEL_COLLAPSE_FULL_START)},e.prototype.collapseFullFinish=function(){t.prototype.collapseFullFinish.call(this),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(s.a.LEFTPANEL_COLLAPSE_FULL_FINISH)},e.prototype.openTreeView=function(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.component.publish(s.a.OPEN_TREE_VIEW)},e.prototype.openThumbsView=function(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.component.publish(s.a.OPEN_THUMBS_VIEW)},e.prototype.selectTopRangeIndex=function(t){this.$treeSelect.prop("selectedIndex",t)},e.prototype.getCurrentCanvasTopRangeIndex=function(){var t=-1,e=this.extension.getCurrentCanvasRange();return e&&(t=Number(e.path.split("/")[0])),t},e.prototype.selectCurrentTreeNode=function(){"uv-openseadragon-extension"===this.extension.name?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()},e.prototype.selectCurrentTreeNodeByRange=function(){if(this.treeView){var t=this.extension.helper.getCurrentRange(),e=null;t&&t.treeNode&&(e=this.treeView.getNodeById(t.treeNode.id)),e?this.treeView.selectNode(e):this.selectTreeNodeByManifest()}},e.prototype.selectCurrentTreeNodeByCanvas=function(){if(this.treeView){var t=null,e=this.getCurrentCanvasTopRangeIndex(),n=e===this.getSelectedTopRangeIndex(),i=null;-1!==e&&(i=this.extension.getCurrentCanvasRange())&&i.treeNode&&(t=this.treeView.getNodeById(i.treeNode.id)),t&&n?this.treeView.selectNode(t):((i=this.extension.helper.getCurrentRange())&&i.treeNode&&(t=this.treeView.getNodeById(i.treeNode.id)),t?this.treeView.selectNode(t):this.selectTreeNodeByManifest())}},e.prototype.selectTreeNodeByManifest=function(){var t=this,e=this.extension.helper.collectionIndex,n=this.extension.helper.manifestIndex,i=this.treeView.getAllNodes(),o=!1;i.map((function(i){i.isCollection()&&i.data.index===e&&(t.treeView.selectNode(i),t.treeView.expandNode(i,!0),o=!0),i.isManifest()&&i.data.index===n&&(t.treeView.selectNode(i),o=!0)})),o||this.treeView.deselectCurrentNode()},e.prototype.resize=function(){t.prototype.resize.call(this),this.$tabsContent.height(this.$main.height()-(this.$tabs.is(":visible")?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())},e}(d.a),I=function(t,e){this.x=t,this.y=e},O=function(){this.region=new h.k(0,0),this.regionPos=new I(0,0),this.size=new h.k(0,0)},S=n(56),N=n(57),B=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),P=function(t){function e(e){return t.call(this,e)||this}return B(e,t),e.prototype.create=function(){var e=this;this.setConfig("downloadDialogue"),t.prototype.create.call(this),this.$settingsButton=$('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=$('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=$('<li class="option single"><input id="'+N.a.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+N.a.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=$('<li class="option single"><input id="'+N.a.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+N.a.WHOLE_IMAGE_HIGH_RES+'label" for="'+N.a.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=$('<li class="option multiple"><input id="'+N.a.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+N.a.WHOLE_IMAGES_HIGH_RES+'label" for="'+N.a.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=$('<li class="option single"><input id="'+N.a.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+N.a.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=$('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=$("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=$('<li class="option"><input id="'+N.a.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+N.a.SELECTION+'label" for="'+N.a.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=$('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=$('<span class="explanatory"></span>');var n=this;this.$downloadButton.on("click",(function(t){t.preventDefault();var i=n.getSelectedOption(),o=i.attr("id"),a=i.attr("title"),r=i.data("mime"),l=N.a.UNKNOWN,p=e.extension.helper.getCurrentCanvas();if(e.renderingUrls[o])r&&(-1!==r.toLowerCase().indexOf("pdf")?l=N.a.ENTIRE_DOCUMENT_AS_PDF:-1!==r.toLowerCase().indexOf("txt")&&(l=N.a.ENTIRE_DOCUMENT_AS_TEXT)),(l=N.a.ENTIRE_DOCUMENT_AS_PDF)&&window.open(e.renderingUrls[o]);else switch(l=o){case N.a.CURRENT_VIEW:var c=n.extension.getViewer();window.open(n.extension.getCroppedImageUri(p,c));break;case N.a.SELECTION:h.a.waitFor((function(){return!e.isActive}),(function(){e.component.publish(s.a.SHOW_MULTISELECT_DIALOGUE)}));break;case N.a.WHOLE_IMAGE_HIGH_RES:window.open(e.getCanvasHighResImageUri(e.extension.helper.getCurrentCanvas()));break;case N.a.WHOLE_IMAGES_HIGH_RES:for(var u=e.extension.getPagedIndices(),d=0;d<u.length;d++)window.open(e.getCanvasHighResImageUri(e.extension.helper.getCanvasByIndex(u[d])));break;case N.a.WHOLE_IMAGE_LOW_RES:var g=n.extension.getConfinedImageUri(p,n.options.confinedImageSize);g&&window.open(g)}e.component.publish(s.a.DOWNLOAD,{type:l,label:a}),e.close()})),this.$settingsButton.onPressed((function(){e.component.publish(s.a.HIDE_DOWNLOAD_DIALOGUE),e.component.publish(s.a.SHOW_SETTINGS_DIALOGUE)}))},e.prototype.open=function(e){t.prototype.open.call(this,e);var n=this.extension.helper.getCurrentCanvas(),i=this.extension.getViewerRotation()%180==0;if(this.isDownloadOptionAvailable(N.a.CURRENT_VIEW)){var o=this.$currentViewAsJpgButton.find("input"),s=this.$currentViewAsJpgButton.find("label"),a=this.content.currentViewAsJpg,r=this.extension.getViewer(),l=this.extension.getCroppedImageDimensions(n,r);if(l?(a=i?h.n.format(a,l.size.width.toString(),l.size.height.toString()):h.n.format(a,l.size.height.toString(),l.size.width.toString()),s.text(a),o.prop("title",a),this.$currentViewAsJpgButton.data("width",l.size.width),this.$currentViewAsJpgButton.data("height",l.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),h.b.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(u=this.content.currentViewAsJpgExplanation)(d=this.$explanatoryTextTemplate.clone()).text(u),s.append(d)}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(N.a.WHOLE_IMAGE_HIGH_RES)){o=this.$wholeImageHighResButton.find("input"),s=this.$wholeImageHighResButton.find("label");if(p=(p=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas()))?h.f.simplifyMimeType(p):"?",c=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas())){a=i?h.n.format(this.content.wholeImageHighRes,c.width.toString(),c.height.toString(),p):h.n.format(this.content.wholeImageHighRes,c.height.toString(),c.width.toString(),p);s.text(a),o.prop("title",a),this.$wholeImageHighResButton.data("width",c.width),this.$wholeImageHighResButton.data("height",c.height),this.$wholeImageHighResButton.show()}else if(n.externalResource&&!n.externalResource.hasServiceDescriptor()){var a=h.n.format(this.content.wholeImageHighRes,"?","?",p);s.text(a),o.prop("title",a),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(h.b.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(u=this.content.wholeImageHighResExplanation)(d=this.$explanatoryTextTemplate.clone()).text(u),s.append(d)}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(N.a.WHOLE_IMAGES_HIGH_RES)){var p;o=this.$wholeImagesHighResButton.find("input"),s=this.$wholeImagesHighResButton.find("label");p=(p=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas()))?h.f.simplifyMimeType(p):"?";a=h.n.format(this.content.wholeImagesHighRes,p);if(s.text(a),o.prop("title",a),this.$wholeImagesHighResButton.show(),h.b.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(u=this.content.wholeImagesHighResExplanation)(d=this.$explanatoryTextTemplate.clone()).text(u),s.append(d)}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(N.a.WHOLE_IMAGE_LOW_RES)){o=this.$wholeImageLowResAsJpgButton.find("input"),s=this.$wholeImageLowResAsJpgButton.find("label");var c=this.extension.getConfinedImageDimensions(n,this.options.confinedImageSize);a=i?h.n.format(this.content.wholeImageLowResAsJpg,c.width.toString(),c.height.toString()):h.n.format(this.content.wholeImageLowResAsJpg,c.height.toString(),c.width.toString());if(s.text(a),o.prop("title",a),this.$wholeImageLowResAsJpgButton.data("width",c.width),this.$wholeImageLowResAsJpgButton.data("height",c.height),this.$wholeImageLowResAsJpgButton.show(),h.b.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(u=this.content.wholeImageLowResAsJpgExplanation)(d=this.$explanatoryTextTemplate.clone()).text(u),s.append(d)}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(N.a.SELECTION)){var u,d;o=this.$selectionButton.find("input");if((s=this.$selectionButton.find("label")).text(this.content.downloadSelection),o.prop("title",this.content.downloadSelection),this.$selectionButton.show(),h.b.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(u=this.content.selectionExplanation)(d=this.$explanatoryTextTemplate.clone()).text(u),s.append(d)}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(N.a.RANGE_RENDERINGS)&&n.ranges&&n.ranges.length)for(var g=0;g<n.ranges.length;g++){var f=n.ranges[g],b=this.getDownloadOptionsForRenderings(f,this.content.entireFileAsOriginal,N.a.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(b)}if(this.isDownloadOptionAvailable(N.a.IMAGE_RENDERINGS)){var m=n.getImages();for(g=0;g<m.length;g++){var b=this.getDownloadOptionsForRenderings(m[g].getResource(),this.content.entireFileAsOriginal,N.a.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(b)}}if(this.isDownloadOptionAvailable(N.a.CANVAS_RENDERINGS)){b=this.getDownloadOptionsForRenderings(n,this.content.entireFileAsOriginal,N.a.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(b)}this.isDownloadOptionAvailable(N.a.MANIFEST_RENDERINGS)&&(!(b=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,N.a.MANIFEST_RENDERINGS)).length&&this.extension.helper.manifest&&(b=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,N.a.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(b));if(this.isDownloadOptionAvailable(N.a.CURRENT_VIEW)){var v=parseInt(this.$currentViewAsJpgButton.data("width").toString()),E=parseInt(this.$currentViewAsJpgButton.data("height").toString()),T=v/parseInt(this.$wholeImageHighResButton.data("width").toString())*100,x=E/parseInt(this.$wholeImageHighResButton.data("height").toString())*100,_=this.options.currentViewDisabledPercentage;T>=_&&x>=_?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}var w=this.$imageOptions.find("li.single");(w=w.sort((function(t,e){var n=$(t).data("width");n&&(n=parseInt(n.toString()));var i=$(t).data("height");i&&(i=parseInt(i.toString()));var o=$(e).data("width");o&&(o=parseInt(o.toString()));var s=$(e).data("height");s&&(s=parseInt(s.toString()));var a=n*i,r=o*s;return a<r?-1:a>r?1:0}))).detach().appendTo(this.$imageOptions),this.$downloadOptions.find("li.group").each((function(t,e){var n=$(e);n.show(),n.find("li.option:hidden").length===n.find("li.option").length&&n.hide()})),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},e.prototype.addDownloadOptionsForRenderings=function(t){var e=this;t.forEach((function(t){switch(t.type){case N.a.IMAGE_RENDERINGS:e.$imageOptions.append(t.button);break;case N.a.CANVAS_RENDERINGS:e.$canvasOptions.append(t.button);break;case N.a.MANIFEST_RENDERINGS:e.$manifestOptions.append(t.button)}}))},e.prototype.getCanvasImageResource=function(t){var e=t.getImages();return e[0]?e[0].getResource():null},e.prototype.getCanvasHighResImageUri=function(t){var e=this.getCanvasComputedDimensions(t);if(e){var n=e.width,i=t.getCanonicalImageUri(n);if(t.externalResource&&t.externalResource.hasServiceDescriptor()){var o=i.split("/"),s=this.extension.getViewerRotation();o[o.length-2]=String(s),i=o.join("/")}return i}return t.externalResource&&!t.externalResource.hasServiceDescriptor()?t.externalResource.dataUri:""},e.prototype.getCanvasMimeType=function(t){var e=this.getCanvasImageResource(t);if(e){var n=e.getFormat();if(n)return n.toString()}return null},e.prototype.getCanvasDimensions=function(t){if(t.externalResource.data){var e=t.externalResource.data.width,n=t.externalResource.data.height;if(e&&n)return new _.Size(e,n)}return null},e.prototype.getCanvasComputedDimensions=function(t){var e=this.getCanvasDimensions(t),n=t.getMaxDimensions();if(!e)return null;if(!n)return e;if(e.width<=n.width&&e.height<=n.height)return e;var i=n.width/e.width,o=n.height/e.height,s=Math.min(i,o);return new _.Size(Math.floor(e.width*s),Math.floor(e.height*s))},e.prototype._isLevel0=function(t){return!(!t||!t.length)&&_.Utils.isLevel0ImageProfile(t[0])},e.prototype.isDownloadOptionAvailable=function(e){if(!this.extension.resources)return!1;var n=this.extension.helper.getCurrentCanvas();if(!n.externalResource.hasServiceDescriptor()||this._isLevel0(n.externalResource.data.profile))return!(e!==N.a.WHOLE_IMAGE_HIGH_RES||!(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length));switch(e){case N.a.CURRENT_VIEW:case N.a.CANVAS_RENDERINGS:case N.a.IMAGE_RENDERINGS:case N.a.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length){var i=n.getMaxDimensions();return!i||i.width<=this.options.maxImageWidth}return!1;case N.a.WHOLE_IMAGES_HIGH_RES:return!!(this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1);case N.a.WHOLE_IMAGE_LOW_RES:var o=this.getCanvasComputedDimensions(n);return!!o&&(!this.extension.isPagingSettingEnabled()&&o.width>this.options.confinedImageSize);case N.a.SELECTION:return this.options.selectionEnabled;case N.a.RANGE_RENDERINGS:return!(!n.ranges||!n.ranges.length)&&n.ranges[0].getRenderings().length>0;default:return t.prototype.isDownloadOptionAvailable.call(this,e)}},e}(S.a),L=n(34),D=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),V=function(t){function e(e){return t.call(this,e)||this}return D(e,t),e.prototype.create=function(){var e=this;this.setConfig("externalContentDialogue"),t.prototype.create.call(this),this.openCommand=s.a.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=s.a.HIDE_EXTERNALCONTENT_DIALOGUE,this.component.subscribe(this.openCommand,(function(t){e.open(),e.$iframe.prop("src",t.uri)})),this.component.subscribe(this.closeCommand,(function(){e.close()})),this.$iframe=$("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()},e.prototype.resize=function(){t.prototype.resize.call(this),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())},e}(L.a),H=n(45),M=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),G=function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.create=function(){var e=this;this.setConfig("mobileFooterPanel"),t.prototype.create.call(this),this.$spacer=$('<div class="spacer"></div>'),this.$options.prepend(this.$spacer),this.$rotateButton=$('\n            <button class="btn imageBtn rotate" title="'+this.content.rotateRight+'">\n                <i class="uv-icon-rotate" aria-hidden="true"></i>'+this.content.rotateRight+"\n            </button>\n        "),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=$('\n            <button class="btn imageBtn zoomOut" title="'+this.content.zoomOut+'">\n                <i class="uv-icon-zoom-out" aria-hidden="true"></i>'+this.content.zoomOut+"\n            </button>\n        "),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=$('\n            <button class="btn imageBtn zoomIn" title="'+this.content.zoomIn+'">\n                <i class="uv-icon-zoom-in" aria-hidden="true"></i>'+this.content.zoomIn+"\n            </button>\n        "),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed((function(){e.component.publish(b.ZOOM_IN)})),this.$zoomOutButton.onPressed((function(){e.component.publish(b.ZOOM_OUT)})),this.$rotateButton.onPressed((function(){e.component.publish(b.ROTATE)}))},e.prototype.resize=function(){t.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},e}(H.a),k=n(44),F=function(){function t(t,e,n,i,o,s,a,r){var l=this;void 0===o&&(o=300),void 0===s&&(s=2),void 0===a&&(a=!1),void 0===r&&(r=!1),this._$element=t,this._autoCompleteFunc=e,this._delay=o,this._minChars=s,this._onSelect=i,this._parseResultsFunc=n,this._positionAbove=a,this._allowWords=r,this._$searchResultsList=$('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=$('<li class="result"><a href="#" tabindex="-1"></a></li>');var p,c=(p=0,function(t,e){clearTimeout(p),p=setTimeout(t,e)}),u=this;this._$element.on("keydown",(function(t){var e=t.originalEvent,n=h.g.getCharCode(e),i=!1;n===k.a.LeftArrow?i=!0:n===k.a.RightArrow&&(i=!0),i&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())})),this._$element.on("keyup",(function(t){if(u._getSelectedListItem().length||t.keyCode!==k.a.Enter){if(u._$searchResultsList.is(":visible")&&u._results.length)if(t.keyCode===k.a.Enter)u._searchForItem(u._getSelectedListItem());else{if(t.keyCode===k.a.DownArrow)return void u._setSelectedResultIndex(1);if(t.keyCode===k.a.UpArrow)return void u._setSelectedResultIndex(-1)}t.keyCode!==k.a.Enter&&c((function(){var t=u._getTerms();t&&t.length>u._minChars&&u._searchForWords(t)?u._search(t):(u._clearResults(),u._hideResults())}),u._delay)}else u._onSelect(u._getTerms())})),$(document).on("mouseup",(function(t){0===l._$searchResultsList.parent().has($(t.target)[0]).length&&(l._clearResults(),l._hideResults())})),this._hideResults()}return t.prototype._searchForWords=function(t){return!(!this._allowWords&&t.includes(" "))},t.prototype._getTerms=function(){return this._$element.val().trim()},t.prototype._setSelectedResultIndex=function(t){var e;e=1===t?this._selectedResultIndex+1:this._selectedResultIndex-1;var n=this._$searchResultsList.find("li");e<0?e=n.length-1:e>n.length-1&&(e=0),this._selectedResultIndex=e,n.removeClass("selected");var i=n.eq(this._selectedResultIndex);i.addClass("selected");var o=i.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(o)},t.prototype._search=function(t){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();var e=this;this._autoCompleteFunc(t,(function(t){e._listResults(t)}))},t.prototype._clearResults=function(){this._$searchResultsList.empty()},t.prototype._hideResults=function(){this._$searchResultsList.hide()},t.prototype._showResults=function(){this._selectedResultIndex=-1,this._$searchResultsList.show()},t.prototype._updateListPosition=function(){this._positionAbove?this._$searchResultsList.css({top:-1*this._$searchResultsList.outerHeight(!0)}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})},t.prototype._listResults=function(t){if(this._results=this._parseResultsFunc(t),this._clearResults(),this._results.length){for(var e=0;e<this._results.length;e++){var n=this._results[e],i=this._$searchResultTemplate.clone();i.find("a").text(n),this._$searchResultsList.append(i)}this._updateListPosition();var o=this;this._$searchResultsList.find("li").on("click",(function(t){t.preventDefault(),o._searchForItem($(this))}))}else this._hideResults()},t.prototype._searchForItem=function(t){var e=t.find("a").text();this._$element.val(e),this._hideResults(),this._onSelect(e),this._clearResults(),this._hideResults()},t.prototype._getSelectedListItem=function(){return this._$searchResultsList.find("li.selected")},t}(),U=n(7),z=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),W=function(t){function e(e){var n=t.call(this,e)||this;return n.placemarkerTouched=!1,n}return z(e,t),e.prototype.create=function(){var e=this;this.setConfig("searchFooterPanel"),t.prototype.create.call(this),this.component.subscribe(s.a.CANVAS_INDEX_CHANGED,(function(){e.canvasIndexChanged(),e.setCurrentSearchResultPlacemarker(),e.updatePrevButton(),e.updateNextButton()})),this.component.subscribe(s.a.CLEAR_ANNOTATIONS,(function(){e.clearSearchResults()})),this.component.subscribe(b.MODE_CHANGED,(function(){e.settingsChanged()})),this.component.subscribe(b.SEARCH,(function(t){e.terms=t})),this.component.subscribe(s.a.ANNOTATIONS,(function(t){e.displaySearchResults(t.annotations,t.terms),e.setCurrentSearchResultPlacemarker(),e.updatePrevButton(),e.updateNextButton()})),this.component.subscribe(s.a.ANNOTATIONS_EMPTY,(function(){e.hideSearchSpinner()})),this.component.subscribe(s.a.ANNOTATION_CHANGED,(function(){e.updatePrevButton(),e.updateNextButton()})),this.$printButton=$('\n          <button class="print btn imageBtn" title="'+this.content.print+'" tabindex="0">\n            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>'+this.content.print+"\n          </button>\n        "),this.$options.prepend(this.$printButton),this.$searchContainer=$('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=$('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=$('<span class="label">'+this.content.searchWithin+"</span>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=$('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=$('<input class="searchText" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=$('<a class="imageButton searchButton" tabindex="0"></a>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=$('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=$('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=$('<a class="previousResult" title="'+this.content.previousResult+'">'+this.content.previousResult+"</a>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=$('<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> \'<span class="terms">y</span>\'</span></div>'),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=$('<a class="clearSearch" title="'+this.content.clearSearch+'">'+this.content.clearSearch+"</a>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=$('<a class="nextResult" title="'+this.content.nextResult+'">'+this.content.nextResult+"</a>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=$('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=$('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=$('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=$('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=$('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=$("<h1></h1>"),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=$("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var n=this;this.$searchButton.on("click",(function(t){t.preventDefault(),e.search(e.$searchText.val())})),this.$searchText.on("focus",(function(){e.$searchText.val()===e.content.enterKeyword&&e.$searchText.val("")})),this.$placemarkerDetails.on("mouseover",(function(){n.component.publish(b.SEARCH_PREVIEW_START,e.currentPlacemarkerIndex)})),this.$placemarkerDetails.on("mouseleave",(function(){$(this).hide(),n.component.publish(b.SEARCH_PREVIEW_FINISH),n.getSearchResultPlacemarkers().removeClass("hover")})),this.$placemarkerDetails.on("click",(function(){n.component.publish(s.a.CANVAS_INDEX_CHANGED,e.currentPlacemarkerIndex)})),this.$previousResultButton.on("click",(function(t){t.preventDefault(),e.isPreviousButtonEnabled()&&n.component.publish(b.PREV_SEARCH_RESULT)})),this.$nextResultButton.on("click",(function(t){t.preventDefault(),e.isNextButtonEnabled()&&n.component.publish(b.NEXT_SEARCH_RESULT)})),this.$clearSearchResultsButton.on("click",(function(t){t.preventDefault(),n.component.publish(s.a.CLEAR_ANNOTATIONS)})),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),1===this.extension.helper.getTotalCanvases()&&this.$searchResultsContainer.hide();var i=this.extension.getAutoCompleteUri();i?new F(this.$searchText,(function(t,e){$.getJSON(h.n.format(i,t),(function(t){e(t)}))}),(function(t){return $.map(t.terms,(function(t){return t.match}))}),(function(t){e.search(t)}),300,2,!0,h.b.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",(function(t){t.keyCode===k.a.Enter&&n.search(n.$searchText.val())})),this.$printButton.onPressed((function(){n.component.publish(b.PRINT)})),this.updatePrintButton(),h.b.getBool(this.config.options.positionMarkerEnabled,!0)||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())},e.prototype.isSearchEnabled=function(){return this.extension.isSearchEnabled()},e.prototype.isZoomToSearchResultEnabled=function(){return h.b.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},e.prototype.isPreviousButtonEnabled=function(){var t=this.extension.helper.canvasIndex,e=this.getFirstSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(t<e)&&(t!==e||0!==n):t>e},e.prototype.isNextButtonEnabled=function(){var t=this.extension.helper.canvasIndex,e=this.getLastSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(t>e)&&(t!==e||n!==this.getLastSearchResultRectIndex()):t<e},e.prototype.getSearchResults=function(){return this.extension.annotations},e.prototype.getCurrentSearchResultRectIndex=function(){return this.extension.getCurrentAnnotationRectIndex()},e.prototype.getFirstSearchResultCanvasIndex=function(){var t=this.getSearchResults();return t?t[0].canvasIndex:-1},e.prototype.getLastSearchResultCanvasIndex=function(){var t=this.getSearchResults();return t?t[t.length-1].canvasIndex:-1},e.prototype.getLastSearchResultRectIndex=function(){return this.extension.getLastAnnotationRectIndex()},e.prototype.updateNextButton=function(){var t=this.getSearchResults();t&&t.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))},e.prototype.updatePrevButton=function(){var t=this.getSearchResults();t&&t.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))},e.prototype.updatePrintButton=function(){h.b.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()},e.prototype.search=function(t){this.terms=t,""!==this.terms&&this.terms!==this.content.enterKeyword?(this.$searchText.blur(),this.showSearchSpinner(),this.component.publish(b.SEARCH,this.terms)):this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,(function(){this.$searchText.focus()}))},e.prototype.getSearchResultPlacemarkers=function(){return this.$searchResultsContainer.find(".searchResultPlacemarker")},e.prototype.setCurrentSearchResultPlacemarker=function(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),$('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")},e.prototype.positionSearchResultPlacemarkers=function(){var t=this.getSearchResults();if(t&&t.length){this.getSearchResultPlacemarkers().remove();for(var e=this.getPageLineRatio(),n=this.$line.position().top,i=this.$line.position().left,o=this,s=0;s<t.length;s++){var a=t[s],r=a.canvasIndex*e,h=$('<div class="searchResultPlacemarker" data-index="'+a.canvasIndex+'"></div>');h[0].ontouchstart=function(t){o.onPlacemarkerTouchStart.call(this,o)},h.click((function(t){o.onPlacemarkerClick.call(this,o)})),h.mouseenter((function(t){o.onPlacemarkerMouseEnter.call(this,o)})),h.mouseleave((function(t){o.onPlacemarkerMouseLeave.call(this,t,o)})),this.$searchResultsContainer.append(h);var l=n-h.height(),p=i+r-h.width()/2;h.css({top:l,left:p})}}},e.prototype.onPlacemarkerTouchStart=function(t){t.placemarkerTouched=!0},e.prototype.onPlacemarkerClick=function(t){t.placemarkerTouched||(t.placemarkerTouched=!1)},e.prototype.onPlacemarkerMouseEnter=function(t){if(!t.placemarkerTouched){var e=$(this);e.addClass("hover");var n=parseInt(e.attr("data-index"));t.component.publish(b.SEARCH_PREVIEW_START,n);var i=t.getSearchResultPlacemarkers().index(e[0]);t.currentPlacemarkerIndex=n,t.$placemarkerDetails.show();var o="{0} {1}";if(t.isPageModeEnabled()){var s=t.extension.helper.getCanvasByIndex(n),a=_.LanguageMap.getValue(s.getLabel());!a&&this.extension.helper.manifest&&(a=this.extension.helper.manifest.options.defaultLabel),a&&(o=h.n.format(o,t.content.pageCaps,a))}else o=h.n.format(o,t.content.imageCaps,String(n+1));t.$placemarkerDetailsTop.html(o);var r=t.getSearchResults();if(r){var l=r[i],p="";t.terms&&(p=h.n.ellipsis(t.terms,t.options.elideDetailsTermsCount));var c=t.content.instanceFound,u=t.content.instancesFound,d="";1===l.rects.length?(d=h.n.format(c,p),t.$placemarkerDetailsBottom.html(d)):(d=h.n.format(u,String(l.rects.length),p),t.$placemarkerDetailsBottom.html(d))}var g=e.position(),f=g.top-t.$placemarkerDetails.height(),m=g.left;m<t.$placemarkerDetails.width()/2?m=0-e.width()/2:m>t.$line.width()-t.$placemarkerDetails.width()/2?m=t.$line.width()-t.$placemarkerDetails.width()+e.width()/2:m-=t.$placemarkerDetails.width()/2,t.$placemarkerDetails.css({top:f,left:m})}},e.prototype.onPlacemarkerMouseLeave=function(t,e){e.component.publish(b.SEARCH_PREVIEW_FINISH);var n=$(this),i=t.toElement||t.relatedTarget,o=$(i).closest(e.$placemarkerDetails).length;i!=e.$placemarkerDetails.get(0)&&0===o&&(e.$placemarkerDetails.hide(),n.removeClass("hover"))},e.prototype.setPageMarkerPosition=function(){if(null!==this.extension.helper.canvasIndex){var t=this.getPageLineRatio(),e=this.$line.position().top,n=this.$line.position().left+this.extension.helper.canvasIndex*t;this.$pagePositionMarker.css({top:e,left:n});var i=this.$line.width();n+this.$pagePositionLabel.outerWidth(!0)>i?(n-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:e,left:n})}},e.prototype.clearSearchResults=function(){this.isSearchEnabled()&&(this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus())},e.prototype.getPageLineRatio=function(){var t=this.$line.width();return 1===this.extension.helper.getTotalCanvases()?0:t/(this.extension.helper.getTotalCanvases()-1)},e.prototype.canvasIndexChanged=function(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()},e.prototype.settingsChanged=function(){this.setPlacemarkerLabel()},e.prototype.setPlacemarkerLabel=function(){var t=this.content.displaying,e=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){var n=this.extension.helper.getCanvasByIndex(e),i=_.LanguageMap.getValue(n.getLabel());i||(i=this.content.defaultLabel);var o=this.extension.helper.getLastCanvasLabel(!0);o&&this.$pagePositionLabel.html(h.n.format(t,this.content.page,Object(U.c)(i),Object(U.c)(o)))}else this.$pagePositionLabel.html(h.n.format(t,this.content.image,String(e+1),this.extension.helper.getTotalCanvases().toString()))},e.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===g.page.toString()&&!h.b.getBool(this.config.options.forceImageMode,!1)},e.prototype.showSearchSpinner=function(){this.$searchText.addClass("searching")},e.prototype.hideSearchSpinner=function(){this.$searchText.removeClass("searching")},e.prototype.displaySearchResults=function(t,e){if(this.isSearchEnabled()){this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});var n=this.$searchResultsInfo.find(".info"),i=n.find(".number"),o=n.find(".foundFor"),s=n.find(".terms");e?(n.show(),i.text(this.extension.getTotalAnnotationRects()),1===t.length?o.html(this.content.resultFoundFor):o.html(this.content.resultsFoundFor),s.html(h.n.ellipsis(e,this.options.elideResultsTermsCount)),s.prop("title",e)):n.hide(),this.$searchPagerContainer.show(),this.resize()}},e.prototype.resize=function(){t.prototype.resize.call(this);var e=this.getSearchResults();e&&e.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());var n=this.$element.width()/2;this.$searchPagerControls.css({left:n-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:n-this.$searchOptions.outerWidth()/2})},e}(H.a),X=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Z=function(t){function e(e){return t.call(this,e)||this}return X(e,t),e.prototype.create=function(){var e=this;this.setConfig("helpDialogue"),t.prototype.create.call(this),this.openCommand=s.a.SHOW_HELP_DIALOGUE,this.closeCommand=s.a.HIDE_HELP_DIALOGUE,this.component.subscribe(this.openCommand,(function(){e.open()})),this.component.subscribe(this.closeCommand,(function(){e.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$message=$("<p></p>"),this.$scroll.append(this.$message),this.$title.text(this.content.title),this.$message.html(this.content.text),this.$message.targetBlank(),this.$element.hide()},e.prototype.resize=function(){t.prototype.resize.call(this)},e}(L.a),j=n(58),J=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Y=function(t){function e(e){return t.call(this,e)||this}return J(e,t),e.prototype.create=function(){var e=this;this.setConfig("moreInfoDialogue"),t.prototype.create.call(this),this.openCommand=s.a.SHOW_MOREINFO_DIALOGUE,this.closeCommand=s.a.HIDE_MOREINFO_DIALOGUE,this.component.subscribe(this.openCommand,(function(t){e.open(t)})),this.component.subscribe(this.closeCommand,(function(){e.close()})),this.config.content=this.extension.data.config.modules.moreInfoRightPanel.content,this.config.options=this.extension.data.config.modules.moreInfoRightPanel.options,this.$title=$("<h1>"+this.config.content.title+"</h1>"),this.$content.append(this.$title),this.$metadata=$('<div class="iiif-metadata-component"></div>'),this.$content.append(this.$metadata),this.metadataComponent=new j.MetadataComponent({target:this.$metadata[0]}),this.$element.hide()},e.prototype.open=function(e){t.prototype.open.call(this,e),this.metadataComponent.set(this._getData())},e.prototype._getData=function(){return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:this.extension.getCurrentCanvases(),canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:h.b.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:null,limit:this.config.options.textLimit||4,limitType:j.LimitType.LINES,manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this.extension.getCurrentCanvasRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:function(t){return Object(U.c)(t)},showAllLanguages:this.config.options.showAllLanguages}},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.resize=function(){this.setDockedPosition()},e}(L.a),K=n(73),q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Q=function(t){function e(e){return t.call(this,e)||this}return q(e,t),e.prototype.create=function(){var e=this;this.setConfig("multiSelectDialogue"),t.prototype.create.call(this);var n=this;this.openCommand=s.a.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=s.a.HIDE_MULTISELECT_DIALOGUE,this.component.subscribe(this.openCommand,(function(){e.open(),e.extension.helper.getMultiSelectState().setEnabled(!0),e.galleryComponent.set(e.data)})),this.component.subscribe(this.closeCommand,(function(){e.close(),e.extension.helper.getMultiSelectState().setEnabled(!1)})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new p.a({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",(function(t){e.component.publish(s.a.MULTISELECTION_MADE,t),n.close()}),!1),this.$element.hide()},e.prototype.isPageModeEnabled=function(){return h.b.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===g.page.toString()},e.prototype.open=function(){t.prototype.open.call(this)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.resize=function(){t.prototype.resize.call(this);var e=this.$gallery.find(".main"),n=this.$gallery.find(".header");e.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-n.height())},e}(L.a),tt=function(){},et=n(72),nt=n(0),it=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ot=function(t){function e(e){var n=t.call(this,e)||this;return n.firstButtonEnabled=!1,n.lastButtonEnabled=!1,n.nextButtonEnabled=!1,n.prevButtonEnabled=!1,n}return it(e,t),e.prototype.create=function(){var e=this;if(this.setConfig("pagingHeaderPanel"),t.prototype.create.call(this),this.component.subscribe(s.a.CANVAS_INDEX_CHANGED,(function(t){e.canvasIndexChanged(t)})),this.component.subscribe(s.a.SETTINGS_CHANGED,(function(){e.modeChanged(),e.updatePagingToggle()})),this.component.subscribe(s.a.CANVAS_INDEX_CHANGE_FAILED,(function(){e.setSearchFieldValue(e.extension.helper.canvasIndex)})),this.component.subscribe(s.a.LEFTPANEL_EXPAND_FULL_START,(function(){e.openGallery()})),this.component.subscribe(s.a.LEFTPANEL_COLLAPSE_FULL_START,(function(){e.closeGallery()})),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('\n          <button class="btn imageBtn first" tabindex="0" title="'+this.content.first+'">\n            <i class="uv-icon-first" aria-hidden="true"></i><span>'+this.content.first+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$firstButton),this.$prevButton=$('\n          <button class="btn imageBtn prev" tabindex="0" title="'+this.content.previous+'">\n            <i class="uv-icon-prev" aria-hidden="true"></i><span>'+this.content.previous+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$prevButton),this.$modeOptions=$('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=$('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=$('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=$('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=$('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),h.b.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=$('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new F(this.$autoCompleteBox,(function(t,n){var i=[],o=e.extension.helper.getCanvases();if(e.isPageModeEnabled())for(var s=0;s<o.length;s++){var a=o[s],r=_.LanguageMap.getValue(a.getLabel());r&&r.startsWith(t)&&i.push(r)}else for(s=0;s<o.length;s++){(a=o[s]).index.toString().startsWith(t)&&i.push(a.index.toString())}n(i)}),(function(t){return t}),(function(t){e.search(t)}),300,0,h.b.getBool(this.options.autocompleteAllowWords,!1));else if(h.b.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=$('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=$('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(var n=0;n<this.extension.helper.getTotalCanvases();n++){var i=this.extension.helper.getCanvasByIndex(n),o=Object(U.c)(_.LanguageMap.getValue(i.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+n+">"+o+"</option>")}this.$imageSelectionBox.change((function(){var t=parseInt(e.$imageSelectionBox.val());e.component.publish(b.IMAGE_SEARCH,t)}))}this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" title="'+this.content.go+'" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('\n          <button class="btn imageBtn next" tabindex="0" title="'+this.content.next+'">\n            <i class="uv-icon-next" aria-hidden="true"></i><span>'+this.content.next+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$nextButton),this.$lastButton=$('\n          <button class="btn imageBtn last" tabindex="0" title="'+this.content.last+'">\n            <i class="uv-icon-last" aria-hidden="true"></i><span>'+this.content.last+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===_.ManifestType.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=$('\n          <button class="btn imageBtn gallery" title="'+this.content.gallery+'" tabindex="0">\n            <i class="uv-icon-gallery" aria-hidden="true"></i>'+this.content.gallery+"\n          </button>\n        "),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=$('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=$('\n          <button class="btn imageBtn one-up" title="'+this.content.oneUp+'" tabindex="0">\n            <i class="uv-icon-one-up" aria-hidden="true"></i>'+this.content.oneUp+"\n          </button>"),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=$('\n          <button class="btn imageBtn two-up" title="'+this.content.twoUp+'" tabindex="0">\n            <i class="uv-icon-two-up" aria-hidden="true"></i>'+this.content.twoUp+"\n          </button>\n        "),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed((function(){e.updateSettings({pagingEnabled:!1}),e.component.publish(b.PAGING_TOGGLED,!1)})),this.$twoUpButton.onPressed((function(){e.updateSettings({pagingEnabled:!0}),e.component.publish(b.PAGING_TOGGLED,!0)})),this.$galleryButton.onPressed((function(){e.component.publish(s.a.TOGGLE_EXPAND_LEFT_PANEL)})),this.setNavigationTitles(),this.setTotal();var a=this.extension.helper.getViewingDirection()||nt.f.LEFT_TO_RIGHT;1===this.extension.helper.getTotalCanvases()&&this.$centerOptions.hide(),this.$firstButton.onPressed((function(){switch(a.toString()){case nt.f.LEFT_TO_RIGHT:case nt.f.TOP_TO_BOTTOM:case nt.f.BOTTOM_TO_TOP:e.component.publish(s.a.FIRST);break;case nt.f.RIGHT_TO_LEFT:e.component.publish(s.a.LAST)}})),this.$prevButton.onPressed((function(){switch(a.toString()){case nt.f.LEFT_TO_RIGHT:case nt.f.BOTTOM_TO_TOP:case nt.f.TOP_TO_BOTTOM:e.component.publish(s.a.PREV);break;case nt.f.RIGHT_TO_LEFT:e.component.publish(s.a.NEXT)}})),this.$nextButton.onPressed((function(){switch(a.toString()){case nt.f.LEFT_TO_RIGHT:case nt.f.BOTTOM_TO_TOP:case nt.f.TOP_TO_BOTTOM:e.component.publish(s.a.NEXT);break;case nt.f.RIGHT_TO_LEFT:e.component.publish(s.a.PREV)}})),this.$lastButton.onPressed((function(){switch(a.toString()){case nt.f.LEFT_TO_RIGHT:case nt.f.TOP_TO_BOTTOM:case nt.f.BOTTOM_TO_TOP:e.component.publish(s.a.LAST);break;case nt.f.RIGHT_TO_LEFT:e.component.publish(s.a.FIRST)}})),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",(function(){e.component.publish(b.MODE_CHANGED,g.image.toString())})),this.$pageModeOption.on("click",(function(){e.component.publish(b.MODE_CHANGED,g.page.toString())}))):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter((function(){e.$searchText.blur(),e.search(e.$searchText.val())})),this.$searchText.click((function(){$(this).select()})),this.$searchButton.onPressed((function(){e.options.autoCompleteBoxEnabled?e.search(e.$autoCompleteBox.val()):e.search(e.$searchText.val())})),!1===this.options.modeOptionsEnabled&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$search.hide(),!1===this.options.helpEnabled&&this.$helpButton.hide(),h.b.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()},e.prototype.openGallery=function(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")},e.prototype.closeGallery=function(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")},e.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===g.page.toString()},e.prototype.setNavigationTitles=function(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))},e.prototype.updatePagingToggle=function(){this.pagingToggleIsVisible()?this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on")):this.$pagingToggleButtons.hide()},e.prototype.pagingToggleIsVisible=function(){return h.b.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()},e.prototype.updateGalleryButton=function(){this.galleryIsVisible()||this.$galleryButton.hide()},e.prototype.galleryIsVisible=function(){return h.b.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()},e.prototype.setTotal=function(){var t=this.content.of;this.isPageModeEnabled()?this.$total.html(h.n.format(t,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(h.n.format(t,this.extension.helper.getTotalCanvases().toString()))},e.prototype.setSearchFieldValue=function(t){var e=this.extension.helper.getCanvasByIndex(t),n=null;if(this.isPageModeEnabled()){var i=_.LanguageMap.getValue(e.getLabel());n="-"===i?"":i}else n=(t+=1).toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(n):this.$searchText.val(n)},e.prototype.search=function(t){if(!t)return this.extension.showMessage(this.content.emptyValue),void this.component.publish(s.a.CANVAS_INDEX_CHANGE_FAILED);if(this.isPageModeEnabled())this.component.publish(b.PAGE_SEARCH,t);else{var e=void 0;if(e=this.options.autoCompleteBoxEnabled?parseInt(this.$autoCompleteBox.val(),10):parseInt(this.$searchText.val(),10),e-=1,isNaN(e))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),void this.component.publish(s.a.CANVAS_INDEX_CHANGE_FAILED);if(!this.extension.helper.getCanvasByIndex(e))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),void this.component.publish(s.a.CANVAS_INDEX_CHANGE_FAILED);this.component.publish(b.IMAGE_SEARCH,e)}},e.prototype.canvasIndexChanged=function(t){this.setSearchFieldValue(t),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$imageSelectionBox.val(t),(this.extension.helper.getViewingDirection()||nt.f.LEFT_TO_RIGHT)===nt.f.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))},e.prototype.disableFirstButton=function(){this.firstButtonEnabled=!1,this.$firstButton.disable()},e.prototype.enableFirstButton=function(){this.firstButtonEnabled=!0,this.$firstButton.enable()},e.prototype.disableLastButton=function(){this.lastButtonEnabled=!1,this.$lastButton.disable()},e.prototype.enableLastButton=function(){this.lastButtonEnabled=!0,this.$lastButton.enable()},e.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.disable()},e.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.enable()},e.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.disable()},e.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.enable()},e.prototype.modeChanged=function(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()},e.prototype.resize=function(){t.prototype.resize.call(this),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())},e}(et.a),st=function(){function t(t,e,n,i){this.x=t,this.y=e,this.w=n,this.h=i}return t.prototype.toString=function(){return this.x+","+this.y+","+this.w+","+this.h},t.fromString=function(e){var n=e.split(",");return new t(Number(n[0]),Number(n[1]),Number(n[2]),Number(n[3]))},t}(),at=n(74),rt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ht=function(t){function e(e){var n=t.call(this,e)||this;return n.controlsVisible=!1,n.isCreated=!1,n.isFirstLoad=!0,n.navigatedFromSearch=!1,n.nextButtonEnabled=!1,n.prevButtonEnabled=!1,n}return rt(e,t),e.prototype.create=function(){var e=this;this.setConfig("openSeadragonCenterPanel"),t.prototype.create.call(this),this.viewerId="osd"+(new Date).getTime(),this.$viewer=$('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.component.subscribe(s.a.ANNOTATIONS,(function(t){e.overlayAnnotations(),e.zoomToInitialAnnotation()})),this.component.subscribe(s.a.SETTINGS_CHANGED,(function(t){e.viewer.gestureSettingsMouse.clickToZoom=t.clickToZoomEnabled})),this.component.subscribe(s.a.OPEN_EXTERNAL_RESOURCE,(function(t){e.whenResized((function(){e.isCreated||e.createUI(),e.openMedia(t)}))})),this.component.subscribe(s.a.CLEAR_ANNOTATIONS,(function(){e.whenCreated((function(){e.extension.currentAnnotationRect=null,e.clearAnnotations()}))})),this.component.subscribe(b.NEXT_SEARCH_RESULT,(function(){e.whenCreated((function(){e.nextAnnotation()}))})),this.component.subscribe(b.PREV_SEARCH_RESULT,(function(){e.whenCreated((function(){e.prevAnnotation()}))})),this.component.subscribe(b.ZOOM_IN,(function(){e.whenCreated((function(){e.zoomIn()}))})),this.component.subscribe(b.ZOOM_OUT,(function(){e.whenCreated((function(){e.zoomOut()}))})),this.component.subscribe(b.ROTATE,(function(){e.whenCreated((function(){e.rotateRight()}))})),this.component.subscribe(s.a.METRIC_CHANGED,(function(){e.whenCreated((function(){e.updateResponsiveView()}))}))},e.prototype.whenCreated=function(t){var e=this;h.a.waitFor((function(){return e.isCreated}),t)},e.prototype.zoomIn=function(){this.viewer.viewport.zoomTo(2*this.viewer.viewport.getZoom(!0))},e.prototype.zoomOut=function(){this.viewer.viewport.zoomTo(.5*this.viewer.viewport.getZoom(!0))},e.prototype.rotateRight=function(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)},e.prototype.updateResponsiveView=function(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?(this.viewer.autoHideControls=!0,this.$viewportNavButtons.show()):(this.viewer.autoHideControls=!1,this.$viewportNavButtons.hide())},e.prototype.createUI=function(){var t=this;this.$spinner=$('<div class="spinner"></div>'),this.$content.append(this.$spinner),Promise.resolve().then(n.t.bind(null,76,7)).then((function(){t.viewer=OpenSeadragon({id:t.viewerId,ajaxWithCredentials:!1,showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:h.b.getBool(t.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:t.config.options.defaultZoomLevel||0,maxZoomPixelRatio:t.config.options.maxZoomPixelRatio||2,controlsFadeDelay:t.config.options.controlsFadeDelay||250,controlsFadeLength:t.config.options.controlsFadeLength||250,navigatorPosition:t.config.options.navigatorPosition||"BOTTOM_RIGHT",animationTime:t.config.options.animationTime||1.2,visibilityRatio:t.config.options.visibilityRatio||.5,constrainDuringPan:h.b.getBool(t.config.options.constrainDuringPan,!1),immediateRender:h.b.getBool(t.config.options.immediateRender,!1),blendTime:t.config.options.blendTime||0,autoHideControls:h.b.getBool(t.config.options.autoHideControls,!0),prefixUrl:t.extension.data.root+"/img/",gestureSettingsMouse:{clickToZoom:h.b.getBool(t.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},zoomOut:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},home:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateright:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateleft:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},next:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},previous:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"}}}),t.$zoomInButton=t.$viewer.find('div[title="Zoom in"]'),t.$zoomInButton.attr("tabindex",0),t.$zoomInButton.prop("title",t.content.zoomIn),t.$zoomInButton.addClass("zoomIn viewportNavButton"),t.$zoomOutButton=t.$viewer.find('div[title="Zoom out"]'),t.$zoomOutButton.attr("tabindex",0),t.$zoomOutButton.prop("title",t.content.zoomOut),t.$zoomOutButton.addClass("zoomOut viewportNavButton"),t.$goHomeButton=t.$viewer.find('div[title="Go home"]'),t.$goHomeButton.attr("tabindex",0),t.$goHomeButton.prop("title",t.content.goHome),t.$goHomeButton.addClass("goHome viewportNavButton"),t.$rotateButton=t.$viewer.find('div[title="Rotate right"]'),t.$rotateButton.attr("tabindex",0),t.$rotateButton.prop("title",t.content.rotateRight),t.$rotateButton.addClass("rotate viewportNavButton"),t.$viewportNavButtonsContainer=t.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),t.$viewportNavButtons=t.$viewportNavButtonsContainer.find(".viewportNavButton"),t.$canvas=$(t.viewer.canvas),t.$canvas.on("contextmenu",(function(){return!1})),t.$navigator=t.$viewer.find(".navigator"),t.setNavigatorVisible(),t.$element.on("mousemove",(function(){t.controlsVisible||(t.controlsVisible=!0,t.viewer.setControlsEnabled(!0))})),t.$element.on("mouseleave",(function(){t.controlsVisible&&(t.controlsVisible=!1,t.viewer.setControlsEnabled(!1))})),t.$element.on("mousemove",(function(){if(!t.$prevButton.ismouseover()&&!t.$nextButton.ismouseover()&&!t.$viewer.find(".navigator").ismouseover()){if(!t.controlsVisible)return;t.controlsVisible=!1,t.viewer.setControlsEnabled(!1)}}),t.config.options.controlsFadeAfterInactive),t.viewer.addHandler("tile-drawn",(function(){t.$spinner.hide()})),t.viewer.addHandler("resize",(function(e){t.component.publish(b.OPENSEADRAGON_RESIZE,e),t.viewerResize(e)})),t.viewer.addHandler("animation-start",(function(e){t.component.publish(b.OPENSEADRAGON_ANIMATION_START,e)})),t.viewer.addHandler("animation",(function(e){t.component.publish(b.OPENSEADRAGON_ANIMATION,e)})),t.viewer.addHandler("animation-finish",(function(e){t.currentBounds=t.getViewportBounds(),t.updateVisibleAnnotationRects(),t.component.publish(b.OPENSEADRAGON_ANIMATION_FINISH,e)})),t.viewer.addHandler("rotate",(function(e){t.component.publish(b.OPENSEADRAGON_ROTATION,e.degrees)})),t.title=t.extension.helper.getLabel(),t.createNavigationButtons(),t.hidePrevButton(),t.hideNextButton(),t.isCreated=!0,t.resize()}))},e.prototype.createNavigationButtons=function(){var t=this,e=this.extension.helper.getViewingDirection()||nt.f.LEFT_TO_RIGHT;switch(this.$prevButton=$('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=$('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_RIGHT}),e){case nt.f.BOTTOM_TO_TOP:case nt.f.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical")}var n=this;this.$prevButton.onPressed((function(i){if(i.preventDefault(),OpenSeadragon.cancelEvent(i),n.prevButtonEnabled)switch(e){case nt.f.LEFT_TO_RIGHT:case nt.f.BOTTOM_TO_TOP:case nt.f.TOP_TO_BOTTOM:t.component.publish(s.a.PREV);break;case nt.f.RIGHT_TO_LEFT:t.component.publish(s.a.NEXT)}})),this.$nextButton.onPressed((function(i){if(i.preventDefault(),OpenSeadragon.cancelEvent(i),n.nextButtonEnabled)switch(e){case nt.f.LEFT_TO_RIGHT:case nt.f.BOTTOM_TO_TOP:case nt.f.TOP_TO_BOTTOM:t.component.publish(s.a.NEXT);break;case nt.f.RIGHT_TO_LEFT:t.component.publish(s.a.PREV)}})),this.$prevButton.on("focus",(function(){t.controlsVisible||(t.controlsVisible=!0,t.viewer.setControlsEnabled(!0))})),this.$nextButton.on("focus",(function(){t.controlsVisible||(t.controlsVisible=!0,t.viewer.setControlsEnabled(!0))}))},e.prototype.openMedia=function(t){var e=this;this.$spinner.show(),this.items=[],this.extension.getExternalResources(t).then((function(t){e.viewer.close(),t=e.getPagePositions(t);for(var n=0;n<t.length;n++){var i=t[n],o=void 0;o=i.hasServiceDescriptor?i:{type:"image",url:i.id,buildPyramid:!1},e.viewer.addTiledImage({tileSource:o,x:i.x,y:i.y,width:i.width,success:function(n){e.items.push(n),e.items.length===t.length&&e.openPagesHandler(),e.resize()}})}}))},e.prototype.getPagePositions=function(t){var e,n,i;if(t.length>1)if(2===t.length)this.extension.helper.isVerticallyAligned()?((n=t[0]).y=0,t[1].y=n.height+this.config.options.pageGap):((e=t[0]).x=0,t[1].x=e.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(var o=0;o<t.length-1;o++)i=t[o],t[o+1].y=(i.y||0)+i.height;else for(o=t.length;o>0;o--)i=t[o],t[o-1].y=(i.y||0)-i.height;else if(this.extension.helper.isLeftToRight())for(o=0;o<t.length-1;o++)i=t[o],t[o+1].x=(i.x||0)+i.width;else for(o=t.length-1;o>0;o--)i=t[o],t[o-1].x=(i.x||0)-i.width;return t},e.prototype.openPagesHandler=function(){(this.component.publish(b.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous())&&(this.showPrevButton(),this.showNextButton(),$(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||nt.f.LEFT_TO_RIGHT)===nt.f.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton()));this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1},e.prototype.zoomToInitialAnnotation=function(){var t=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,t&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(t)},e.prototype.overlayAnnotations=function(){for(var t=this.getAnnotationsForCurrentImages(),e=0;e<t.length;e++)for(var n=t[e],i=this.getAnnotationOverlayRects(n),o=0;o<i.length;o++){var s=i[o],a=document.createElement("div");a.id="searchResult-"+s.canvasIndex+"-"+s.resultIndex,a.className="searchOverlay",a.title=Object(U.c)(s.chars),this.viewer.addOverlay(a,s)}},e.prototype.updateBounds=function(){var t=this.extension.getSettings();this.isFirstLoad?(this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation)),this.initialBounds=this.extension.data.xywh,this.initialBounds&&(this.initialBounds=st.fromString(this.initialBounds),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))):t.preserveViewport?this.fitToBounds(this.currentBounds):this.goHome()},e.prototype.goHome=function(){this.viewer.viewport.goHome(!0)},e.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")},e.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")},e.prototype.hidePrevButton=function(){this.disablePrevButton(),this.$prevButton.hide()},e.prototype.showPrevButton=function(){this.enablePrevButton(),this.$prevButton.show()},e.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")},e.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")},e.prototype.hideNextButton=function(){this.disableNextButton(),this.$nextButton.hide()},e.prototype.showNextButton=function(){this.enableNextButton(),this.$nextButton.show()},e.prototype.fitToBounds=function(t,e){void 0===e&&(e=!0);var n=new OpenSeadragon.Rect;n.x=Number(t.x),n.y=Number(t.y),n.width=Number(t.w),n.height=Number(t.h),this.viewer.viewport.fitBoundsWithConstraints(n,e)},e.prototype.getCroppedImageBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var t=this.extension.helper.getCurrentCanvas(),e=this.extension.getCroppedImageDimensions(t,this.viewer);return e?new st(e.regionPos.x,e.regionPos.y,e.region.width,e.region.height).toString():null},e.prototype.getViewportBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var t=this.viewer.viewport.getBounds(!0);return new st(Math.floor(t.x),Math.floor(t.y),Math.floor(t.width),Math.floor(t.height))},e.prototype.viewerResize=function(t){if(t.viewport){var e=t.viewport.getCenter(!0);e&&setTimeout((function(){t.viewport.panTo(e,!0)}),1)}},e.prototype.clearAnnotations=function(){this.$canvas.find(".searchOverlay").hide()},e.prototype.getAnnotationsForCurrentImages=function(){var t=[],e=this.extension.annotations;if(!e||!e.length)return t;for(var n=this.extension.getPagedIndices(),i=0;i<n.length;i++)for(var o=n[i],s=0;s<e.length;s++)if(e[s].canvasIndex===o){t.push(e[s]);break}return t},e.prototype.getAnnotationRectsForCurrentImages=function(){var t=this.getAnnotationsForCurrentImages();return t.length?t.map((function(t){return t.rects})).reduce((function(t,e){return t.concat(e)})):[]},e.prototype.updateVisibleAnnotationRects=function(){for(var t=this.getAnnotationRectsForCurrentImages(),e=0;e<t.length;e++){var n=t[e],i=this.viewer.viewport.getBounds();n.isVisible=h.d.hitRect(i.x,i.y,i.width,i.height,n.viewportX,n.viewportY)}},e.prototype.getAnnotationRectIndex=function(t){return this.getAnnotationRectsForCurrentImages().indexOf(t)},e.prototype.isZoomToSearchResultEnabled=function(){return h.b.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},e.prototype.prevAnnotation=function(){for(var t=this.getAnnotationRectsForCurrentImages(),e=this.extension.currentAnnotationRect,n=null,i=(e?this.getAnnotationRectIndex(e):t.length)-1;i>=0;i--){n=t[i];break}n&&this.isZoomToSearchResultEnabled()?n.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=n,this.navigatedFromSearch=!0,this.component.publish(s.a.ANNOTATION_CANVAS_CHANGED,[n])):this.zoomToAnnotation(n):(this.navigatedFromSearch=!0,this.component.publish(b.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))},e.prototype.nextAnnotation=function(){for(var t=this.getAnnotationRectsForCurrentImages(),e=this.extension.currentAnnotationRect,n=null,i=(e?this.getAnnotationRectIndex(e):-1)+1;i<t.length;i++){n=t[i];break}n&&this.isZoomToSearchResultEnabled()?n.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=n,this.navigatedFromSearch=!0,this.component.publish(s.a.ANNOTATION_CANVAS_CHANGED,[n])):this.zoomToAnnotation(n):(this.navigatedFromSearch=!0,this.component.publish(b.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))},e.prototype.getAnnotationRectByIndex=function(t){var e=this.getAnnotationRectsForCurrentImages();return e.length?e[t]:null},e.prototype.getInitialAnnotationRect=function(){var t=this,e=this.getAnnotationRectsForCurrentImages();if(!e.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){var n=e.filter((function(e){return e.canvasIndex===t.extension.helper.canvasIndex}));return n[n.length-1]}return e.filter((function(e){return e.canvasIndex===t.extension.helper.canvasIndex}))[0]},e.prototype.zoomToAnnotation=function(t){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||t,this.extension.currentAnnotationRect=t,h.b.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new st(t.viewportX,t.viewportY,t.width,t.height),!1);else{var e=t.viewportX-(.5*this.currentBounds.w-.5*t.width),n=t.viewportY-(.5*this.currentBounds.h-.5*t.height),i=this.currentBounds.w,o=this.currentBounds.h,a=new st(e,n,i,o);this.fitToBounds(a)}this.highlightAnnotationRect(t),this.component.publish(s.a.ANNOTATION_CHANGED)},e.prototype.highlightAnnotationRect=function(t){var e=$("#searchResult-"+t.canvasIndex+"-"+t.index);e.addClass("current"),$(".searchOverlay").not(e).removeClass("current")},e.prototype.getAnnotationOverlayRects=function(t){var e=[];if(!this.extension.resources)return e;var n=this.extension.resources.filter((function(e){return e.index===t.canvasIndex}))[0],i=this.extension.resources.indexOf(n),o=0;i>0&&(o=this.extension.resources[i-1].width);for(var s=0;s<t.rects.length;s++){var a=t.rects[s],r=a.x+o+(i>0?this.config.options.pageGap:0),h=a.y,l=a.width,p=a.height,c=new OpenSeadragon.Rect(r,h,l,p);a.viewportX=r,a.viewportY=h,c.canvasIndex=a.canvasIndex,c.resultIndex=a.index,c.chars=a.chars,e.push(c)}return e},e.prototype.resize=function(){var e=this;if(t.prototype.resize.call(this),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),this.isCreated){this.title&&this.$title.text(Object(U.c)(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);var n=this.extension.helper.getViewingDirection()||nt.f.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){var i=Math.floor(this.$content.width()/2);switch(n){case nt.f.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",-1*i-this.$nextButton.outerWidth()/2);break;case nt.f.TOP_TO_BOTTOM:this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",-1*i-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2)}}setTimeout((function(){if(e.extension.helper.isContinuous())if(e.extension.helper.isHorizontallyAligned()){var t=e.$viewer.width()-e.$viewer.rightMargin();e.$navigator.width(t)}else e.$navigator.height(e.$viewer.height())}),100)}},e.prototype.setFocus=function(){this.$canvas.is(":focus")||this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()},e.prototype.setNavigatorVisible=function(){var t=h.b.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer.navigator.setVisible(t),t?this.$navigator.show():this.$navigator.hide()},e}(at.a),lt=n(59),pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ct=function(t){function e(e){return t.call(this,e)||this}return pt(e,t),e.prototype.create=function(){var e=this;this.setConfig("settingsDialogue"),t.prototype.create.call(this),this.$navigatorEnabled=$('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=$('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=$('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=$('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=$('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=$('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=$('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=$('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=$('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=$('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=$('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=$('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change((function(){var t={};e.$navigatorEnabledCheckbox.is(":checked")?t.navigatorEnabled=!0:t.navigatorEnabled=!1,e.updateSettings(t)})),this.$clickToZoomEnabledCheckbox.change((function(){var t={};e.$clickToZoomEnabledCheckbox.is(":checked")?t.clickToZoomEnabled=!0:t.clickToZoomEnabled=!1,e.updateSettings(t)})),this.$pagingEnabledCheckbox.change((function(){var t={};e.$pagingEnabledCheckbox.is(":checked")?t.pagingEnabled=!0:t.pagingEnabled=!1,e.updateSettings(t)})),this.$preserveViewportCheckbox.change((function(){var t={};e.$preserveViewportCheckbox.is(":checked")?t.preserveViewport=!0:t.preserveViewport=!1,e.updateSettings(t)}))},e.prototype.open=function(){t.prototype.open.call(this);var e=this.getSettings();e.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),e.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?e.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),e.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")},e}(lt.a),ut=n(60),dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),gt=function(t){function e(e){var n=t.call(this,e)||this;return n.component.subscribe(b.OPENSEADRAGON_OPEN,(function(){n.update()})),n.component.subscribe(b.OPENSEADRAGON_ANIMATION_FINISH,(function(){n.update()})),n}return dt(e,t),e.prototype.create=function(){this.setConfig("shareDialogue"),t.prototype.create.call(this)},e.prototype.update=function(){t.prototype.update.call(this);var e=this.extension.getViewportBounds(),n=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,e,n),this.$code.val(this.code)},e.prototype.resize=function(){t.prototype.resize.call(this)},e}(ut.a),ft=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.annotations=[],e.currentRotation=0,e.isAnnotating=!1,e}return ft(e,t),e.prototype.create=function(){var e=this;t.prototype.create.call(this),this.component.subscribe(s.a.METRIC_CHANGED,(function(){if(e.isDesktopMetric())e.shell.$rightPanel.show();else{var t={pagingEnabled:!1};e.updateSettings(t),e.component.publish(s.a.UPDATE_SETTINGS),e.shell.$rightPanel.hide()}})),this.component.subscribe(s.a.CANVAS_INDEX_CHANGED,(function(t){e.previousAnnotationRect=null,e.currentAnnotationRect=null,e.viewPage(t)})),this.component.subscribe(s.a.CLEAR_ANNOTATIONS,(function(){e.clearAnnotations(),e.component.publish(s.a.ANNOTATIONS_CLEARED),e.fire(s.a.CLEAR_ANNOTATIONS)})),this.component.subscribe(s.a.DOWN_ARROW,(function(){e.useArrowKeysToNavigate()||e.centerPanel.setFocus()})),this.component.subscribe(s.a.END,(function(){e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.helper.getLastPageIndex())})),this.component.subscribe(s.a.FIRST,(function(){e.fire(s.a.FIRST),e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.helper.getFirstPageIndex())})),this.component.subscribe(s.a.GALLERY_DECREASE_SIZE,(function(){e.fire(s.a.GALLERY_DECREASE_SIZE)})),this.component.subscribe(s.a.GALLERY_INCREASE_SIZE,(function(){e.fire(s.a.GALLERY_INCREASE_SIZE)})),this.component.subscribe(s.a.GALLERY_THUMB_SELECTED,(function(){e.fire(s.a.GALLERY_THUMB_SELECTED)})),this.component.subscribe(s.a.HOME,(function(){e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.helper.getFirstPageIndex())})),this.component.subscribe(b.IMAGE_SEARCH,(function(t){e.fire(b.IMAGE_SEARCH,t),e.component.publish(s.a.CANVAS_INDEX_CHANGED,t)})),this.component.subscribe(s.a.LAST,(function(){e.fire(s.a.LAST),e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.helper.getLastPageIndex())})),this.component.subscribe(s.a.LEFT_ARROW,(function(){e.useArrowKeysToNavigate()?e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getPrevPageIndex()):e.centerPanel.setFocus()})),this.component.subscribe(s.a.LEFTPANEL_COLLAPSE_FULL_START,(function(){e.isDesktopMetric()&&e.shell.$rightPanel.show()})),this.component.subscribe(s.a.LEFTPANEL_COLLAPSE_FULL_FINISH,(function(){e.shell.$centerPanel.show(),e.resize()})),this.component.subscribe(s.a.LEFTPANEL_EXPAND_FULL_START,(function(){e.shell.$centerPanel.hide(),e.shell.$rightPanel.hide()})),this.component.subscribe(s.a.MINUS,(function(){e.centerPanel.setFocus()})),this.component.subscribe(b.MODE_CHANGED,(function(t){e.fire(b.MODE_CHANGED,t),e.mode=new g(t);var n=e.getSettings();e.component.publish(s.a.SETTINGS_CHANGED,n)})),this.component.subscribe(s.a.MULTISELECTION_MADE,(function(t){var n=new tt;n.manifestUri=e.helper.manifestUri,n.allCanvases=t.length===e.helper.getCanvases().length,n.canvases=t,n.format=e.data.config.options.multiSelectionMimeType,n.sequence=e.helper.getCurrentSequence().id,e.fire(s.a.MULTISELECTION_MADE,n)})),this.component.subscribe(s.a.NEXT,(function(){e.fire(s.a.NEXT),e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getNextPageIndex())})),this.component.subscribe(b.NEXT_SEARCH_RESULT,(function(){e.fire(b.NEXT_SEARCH_RESULT)})),this.component.subscribe(b.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,(function(){e.fire(b.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),e.nextSearchResult()})),this.component.subscribe(b.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,(function(){e.fire(b.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),e.prevSearchResult()})),this.component.subscribe(s.a.OPEN_THUMBS_VIEW,(function(){e.fire(s.a.OPEN_THUMBS_VIEW)})),this.component.subscribe(s.a.OPEN_TREE_VIEW,(function(){e.fire(s.a.OPEN_TREE_VIEW)})),this.component.subscribe(s.a.PAGE_DOWN,(function(){e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getNextPageIndex())})),this.component.subscribe(b.PAGE_SEARCH,(function(t){e.fire(b.PAGE_SEARCH,t),e.viewLabel(t)})),this.component.subscribe(s.a.PAGE_UP,(function(){e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getPrevPageIndex())})),this.component.subscribe(b.PAGING_TOGGLED,(function(t){e.fire(b.PAGING_TOGGLED,t)})),this.component.subscribe(s.a.PLUS,(function(){e.centerPanel.setFocus()})),this.component.subscribe(s.a.PREV,(function(){e.fire(s.a.PREV),e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getPrevPageIndex())})),this.component.subscribe(b.PREV_SEARCH_RESULT,(function(){e.fire(b.PREV_SEARCH_RESULT)})),this.component.subscribe(b.PRINT,(function(){e.print()})),this.component.subscribe(s.a.RELOAD,(function(){e.component.publish(s.a.CLEAR_ANNOTATIONS)})),this.component.subscribe(s.a.RIGHT_ARROW,(function(){e.useArrowKeysToNavigate()?e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.getNextPageIndex()):e.centerPanel.setFocus()})),this.component.subscribe(b.OPENSEADRAGON_ANIMATION,(function(){e.fire(b.OPENSEADRAGON_ANIMATION)})),this.component.subscribe(b.OPENSEADRAGON_ANIMATION_FINISH,(function(t){var n=e.centerPanel.getViewportBounds();e.centerPanel&&n&&(e.component.publish(b.XYWH_CHANGED,n.toString()),e.data.xywh=n.toString(),e.fire(b.XYWH_CHANGED,e.data.xywh));var i=e.helper.getCurrentCanvas();e.fire(b.CURRENT_VIEW_URI,{cropUri:e.getCroppedImageUri(i,e.getViewer()),fullUri:e.getConfinedImageUri(i,i.getWidth())})})),this.component.subscribe(b.OPENSEADRAGON_ANIMATION_START,(function(){e.fire(b.OPENSEADRAGON_ANIMATION_START)})),this.component.subscribe(b.OPENSEADRAGON_OPEN,(function(){e.useArrowKeysToNavigate()||e.centerPanel.setFocus(),e.fire(b.OPENSEADRAGON_OPEN)})),this.component.subscribe(b.OPENSEADRAGON_RESIZE,(function(){e.fire(b.OPENSEADRAGON_RESIZE)})),this.component.subscribe(b.OPENSEADRAGON_ROTATION,(function(t){e.data.rotation=t,e.fire(b.OPENSEADRAGON_ROTATION,e.data.rotation),e.currentRotation=t})),this.component.subscribe(b.SEARCH,(function(t){e.fire(b.SEARCH,t),e.search(t)})),this.component.subscribe(b.SEARCH_PREVIEW_FINISH,(function(){e.fire(b.SEARCH_PREVIEW_FINISH)})),this.component.subscribe(b.SEARCH_PREVIEW_START,(function(){e.fire(b.SEARCH_PREVIEW_START)})),this.component.subscribe(s.a.ANNOTATIONS,(function(t){e.fire(s.a.ANNOTATIONS,t)})),this.component.subscribe(s.a.ANNOTATION_CANVAS_CHANGED,(function(t){e.component.publish(s.a.CANVAS_INDEX_CHANGED,t[0].canvasIndex)})),this.component.subscribe(s.a.ANNOTATIONS_EMPTY,(function(){e.fire(s.a.ANNOTATIONS_EMPTY)})),this.component.subscribe(s.a.THUMB_SELECTED,(function(t){e.component.publish(s.a.CANVAS_INDEX_CHANGED,t.index)})),this.component.subscribe(s.a.TREE_NODE_SELECTED,(function(t){e.fire(s.a.TREE_NODE_SELECTED,t.data.path),e.treeNodeSelected(t)})),this.component.subscribe(s.a.UP_ARROW,(function(){e.useArrowKeysToNavigate()||e.centerPanel.setFocus()})),this.component.subscribe(s.a.UPDATE_SETTINGS,(function(){e.component.publish(s.a.CANVAS_INDEX_CHANGED,e.helper.canvasIndex);var t=e.getSettings();e.component.publish(s.a.SETTINGS_CHANGED,t)}))},e.prototype.createModules=function(){t.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new ot(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new C(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new ht(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new K.a(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new W(this.shell.$footerPanel),this.mobileFooterPanel=new G(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new Z(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new Y(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new Q(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new gt(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new P(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new ct(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new V(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},e.prototype.render=function(){t.prototype.render.call(this),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()},e.prototype.checkForAnnotations=function(){if(this.data.annotations){var t=this.parseAnnotationList(this.data.annotations);this.component.publish(s.a.CLEAR_ANNOTATIONS),this.annotate(t)}},e.prototype.annotate=function(t,e){this.annotations=t,this.annotations=t.sort((function(t,e){return t.canvasIndex-e.canvasIndex}));var n=new o;n.terms=e,n.annotations=this.annotations,this.component.publish(s.a.ANNOTATIONS,n)},e.prototype.checkForSearchParam=function(){var t=this.data.highlight;t&&(t.replace(/\+/g," ").replace(/"/g,""),this.component.publish(b.SEARCH,t))},e.prototype.checkForRotationParam=function(){var t=this.data.rotation;t&&this.component.publish(b.OPENSEADRAGON_ROTATION,t)},e.prototype.viewPage=function(t){if(-1!==t){var e=!1;if(t===this.helper.canvasIndex&&(e=!0),this.helper.isCanvasIndexOutOfRange(t)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),t=0),this.isPagingSettingEnabled()&&!e)if(this.getPagedIndices(t).includes(this.helper.canvasIndex))return void this.viewCanvas(t);this.viewCanvas(t)}},e.prototype.getViewer=function(){return this.centerPanel.viewer},e.prototype.getMode=function(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case _.ManifestType.MONOGRAPH:case _.ManifestType.MANUSCRIPT:return g.page;default:return g.image}},e.prototype.getViewportBounds=function(){if(!this.centerPanel)return null;var t=this.centerPanel.getViewportBounds();return t?t.toString():null},e.prototype.getViewerRotation=function(){return this.centerPanel?this.currentRotation:null},e.prototype.viewRange=function(t){var e=this.helper.getRangeByPath(t);if(e){var n=e.getCanvasIds()[0],i=this.helper.getCanvasIndexById(n);this.component.publish(s.a.CANVAS_INDEX_CHANGED,i)}},e.prototype.viewLabel=function(t){if(!t)return this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),void this.component.publish(s.a.CANVAS_INDEX_CHANGE_FAILED);var e=this.helper.getCanvasIndexByLabel(t);-1!=e?this.component.publish(s.a.CANVAS_INDEX_CHANGED,e):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.component.publish(s.a.CANVAS_INDEX_CHANGE_FAILED))},e.prototype.treeNodeSelected=function(t){var e=t.data;if(e.type)switch(e.type){case nt.b.MANIFEST:this.viewManifest(e);break;case nt.b.COLLECTION:this.viewCollection(e);break;default:this.viewRange(e.path)}},e.prototype.clearAnnotations=function(){this.annotations=null,this.component.publish(s.a.CANVAS_INDEX_CHANGED,this.helper.canvasIndex)},e.prototype.prevSearchResult=function(){var t;if(this.annotations)for(var e=this.annotations.length-1;e>=0;e--){var n=this.annotations[e];if(n.canvasIndex<=this.getPrevPageIndex()){t=n,this.component.publish(s.a.CANVAS_INDEX_CHANGED,t.canvasIndex);break}}},e.prototype.nextSearchResult=function(){if(this.annotations)for(var t=0;t<this.annotations.length;t++){var e=this.annotations[t];if(e&&e.canvasIndex>=this.getNextPageIndex()){this.component.publish(s.a.CANVAS_INDEX_CHANGED,e.canvasIndex);break}}},e.prototype.bookmark=function(){t.prototype.bookmark.call(this);var e=this.helper.getCurrentCanvas(),n=new r.a;n.index=this.helper.canvasIndex,n.label=_.LanguageMap.getValue(e.getLabel()),n.path=this.getCroppedImageUri(e,this.getViewer()),n.thumb=e.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),n.title=this.helper.getLabel(),n.trackingLabel=window.trackingLabel,n.type=nt.a.IMAGE,this.fire(s.a.BOOKMARK,n)},e.prototype.print=function(){window.print(),this.fire(b.PRINT)},e.prototype.getCroppedImageDimensions=function(t,e){if(!e)return null;if(!e.viewport)return null;if(!t.getHeight()||!t.getWidth())return null;var n=e.viewport.getBounds(!0),i=new O,o=Math.floor(n.width),s=Math.floor(n.height),a=Math.floor(n.x),r=Math.floor(n.y);a+o>t.getWidth()?o=t.getWidth()-a:a<0&&(o+=a),a<0&&(a=0),r+s>t.getHeight()?s=t.getHeight()-r:r<0&&(s+=r),r<0&&(r=0);var h=o=Math.min(o,t.getWidth()),l=s=Math.min(s,t.getHeight()),p=t.getMaxDimensions();if(p){if(o>p.width){var c=p.width;s=Math.round(c*(s/o)),o=c}if(s>p.height){var u=p.height;o=Math.round(o/s*u),s=u}}return i.region=new _.Size(h,l),i.regionPos=new I(a,r),i.size=new _.Size(o,s),i},e.prototype.getCroppedImageUri=function(t,e){if(!e)return null;if(!e.viewport)return null;var n=this.getCroppedImageDimensions(t,e);if(!n)return null;var i=this.getImageBaseUri(t),o=this.getImageId(t);if(!o)return null;return i+"/"+o+"/"+(n.regionPos.x+","+n.regionPos.y+","+n.region.width+","+n.region.height)+"/"+(n.size.width+","+n.size.height)+"/"+this.getViewerRotation()+"/default.jpg"},e.prototype.getConfinedImageDimensions=function(t,e){var n=new _.Size(0,0);n.width=e;var i=h.h.normalise(e,0,t.getWidth());return n.height=Math.floor(t.getHeight()*i),n},e.prototype.getConfinedImageUri=function(t,e){var n=this.getImageBaseUri(t),i=this.getImageId(t);if(!i)return null;var o=this.getConfinedImageDimensions(t,e);return n+"/"+i+"/full/"+(o.width+","+o.height)+"/"+this.getViewerRotation()+"/default.jpg"},e.prototype.getImageId=function(t){if(t.externalResource){var e=t.externalResource.data["@id"];if(e)return e.substr(e.lastIndexOf("/")+1)}return null},e.prototype.getImageBaseUri=function(t){var e=this.getInfoUri(t);return(e=e.substr(0,e.lastIndexOf("/"))).substr(0,e.lastIndexOf("/"))},e.prototype.getInfoUri=function(t){var e=null,n=t.getImages();if(n&&n.length)for(var i=n[0].getResource().getServices(),o=0;o<i.length;o++){var s=i[o],a=s.id;a.endsWith("/")||(a+="/"),_.Utils.isImageProfile(s.getProfile())&&(e=a+"info.json")}return e||(e="lib/imageunavailable.json"),e},e.prototype.getEmbedScript=function(t,e,n,i,o){var s=this.data.config.uri||"",a=this.getSerializedLocales(),r=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex+"&config="+s+"&locales="+a+"&xywh="+i+"&r="+o;return h.n.format(t,r,e.toString(),n.toString())},e.prototype.getPrevPageIndex=function(t){var e;if(void 0===t&&(t=this.helper.canvasIndex),this.isPagingSettingEnabled()){var n=this.getPagedIndices(t);e=this.helper.isRightToLeft()?n[n.length-1]-1:n[0]-1}else e=t-1;return e},e.prototype.isSearchEnabled=function(){return!!h.b.getBool(this.data.config.options.searchWithinEnabled,!1)&&!!this.helper.getSearchService()},e.prototype.isPagingSettingEnabled=function(){return!!this.helper.isPagingAvailable()&&this.getSettings().pagingEnabled},e.prototype.getNextPageIndex=function(t){var e;if(void 0===t&&(t=this.helper.canvasIndex),this.isPagingSettingEnabled()){var n=this.getPagedIndices(t);e=this.helper.isRightToLeft()?n[0]+1:n[n.length-1]+1}else e=t+1;return e>this.helper.getTotalCanvases()-1?-1:e},e.prototype.getAutoCompleteService=function(){var t=this.helper.getSearchService();return t?t.getService(nt.e.SEARCH_0_AUTO_COMPLETE)||t.getService(nt.e.SEARCH_1_AUTO_COMPLETE):null},e.prototype.getAutoCompleteUri=function(){var t=this.getAutoCompleteService();return t?t.id+"?q={0}":null},e.prototype.getSearchServiceUri=function(){var t=this.helper.getSearchService();if(!t)return null;var e=t.id;return e+="?q={0}"},e.prototype.search=function(t){var e=this;if(!this.isAnnotating){this.isAnnotating=!0,this.annotations=[];var n=this,i=this.getSearchServiceUri();i&&(i=h.n.format(i,encodeURIComponent(t)),this.getSearchResults(i,t,this.annotations,(function(i){n.isAnnotating=!1,i.length?n.annotate(i,t):n.showMessage(n.data.config.modules.genericDialogue.content.noMatches,(function(){e.component.publish(s.a.ANNOTATIONS_EMPTY)}))})))}},e.prototype.getSearchResults=function(t,e,n,i){var o=this;$.getJSON(t,(function(t){t.resources&&t.resources.length&&(n=n.concat(o.parseAnnotationList(t))),t.next?o.getSearchResults(t.next,e,n,i):i(n)}))},e.prototype.parseAnnotationList=function(t){for(var e=[],n=function(n){var o=t.resources[n],s=i.helper.getCanvasIndexById(o.on.match(/(.*)#/)[1]),a=new w.a(o,s),r=e.filter((function(t){return t.canvasIndex===a.canvasIndex}))[0];r?r.addRect(o):e.push(a)},i=this,o=0;o<t.resources.length;o++)n(o);return e.sort((function(t,e){return t.canvasIndex-e.canvasIndex})),e},e.prototype.getAnnotationRects=function(){return this.annotations?this.annotations.map((function(t){return t.rects})).reduce((function(t,e){return t.concat(e)})):[]},e.prototype.getCurrentAnnotationRectIndex=function(){var t=this.getAnnotationRects();return this.currentAnnotationRect?t.indexOf(this.currentAnnotationRect):-1},e.prototype.getTotalAnnotationRects=function(){return this.getAnnotationRects().length},e.prototype.isFirstAnnotationRect=function(){return 0===this.getCurrentAnnotationRectIndex()},e.prototype.getLastAnnotationRectIndex=function(){return this.getTotalAnnotationRects()-1},e.prototype.getPagedIndices=function(t){void 0===t&&(t=this.helper.canvasIndex);var e=[];return this.helper.isContinuous()?e=$.map(this.helper.getCanvases(),(function(t,e){return e})):this.isPagingSettingEnabled()?(e=this.helper.isFirstCanvas(t)||this.helper.isLastCanvas(t)&&this.helper.isTotalCanvasesEven()?[t]:t%2?[t,t+1]:[t-1,t],this.helper.isRightToLeft()&&(e=e.reverse())):e.push(this.helper.canvasIndex),e},e}(a.a);e.default=bt}}]);